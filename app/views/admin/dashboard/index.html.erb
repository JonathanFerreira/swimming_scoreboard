<% content_for :title, "Admin Dashboard" %>

<div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10">
  <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
    <h2 class="text-title-md2 font-bold text-black dark:text-white">
      Dashboard
    </h2>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-6 xl:grid-cols-4 2xl:gap-7.5">
    <div class="rounded-lg border border-blue-200 bg-blue-300 py-6 px-7.5 shadow-lg">
      <div class="flex h-11.5 w-11.5 items-center justify-center rounded-full bg-blue-500">
        <svg class="fill-white" width="22" height="16" viewBox="0 0 22 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11 15.1156C4.19376 15.1156 0.825012 8.61876 0.618762 8.28001C0.540012 8.13126 0.540012 7.86876 0.618762 7.72126C0.825012 7.38251 4.19376 0.88501 11 0.88501C17.8063 0.88501 21.175 7.38251 21.3813 7.72126C21.46 7.86876 21.46 8.13126 21.3813 8.28001C21.175 8.61876 17.8063 15.1156 11 15.1156ZM2.16251 8.00001C3.74001 10.0688 7.09001 13.8688 11 13.8688C14.91 13.8688 18.26 10.0688 19.8375 8.00001C18.26 5.93126 14.91 2.13126 11 2.13126C7.09001 2.13126 3.74001 5.93126 2.16251 8.00001Z" fill=""></path>
          <path d="M11 10.9219C9.38438 10.9219 8.07812 9.61562 8.07812 8C8.07812 6.38438 9.38438 5.07812 11 5.07812C12.6156 5.07812 13.9219 6.38438 13.9219 8C13.9219 9.61562 12.6156 10.9219 11 10.9219ZM11 6.625C10.3813 6.625 9.875 7.13125 9.875 7.75C9.875 8.36875 10.3813 8.875 11 8.875C11.6187 8.875 12.125 8.36875 12.125 7.75C12.125 7.13125 11.6187 6.625 11 6.625Z" fill=""></path>
        </svg>
      </div>

      <div class="mt-4 flex items-end justify-between">
        <div>
          <h4 class="text-2xl font-bold text-blue-900">
            <%= @competitions_count %>
          </h4>
          <span class="text-sm font-medium text-blue-800">Total Competitions</span>
        </div>
      </div>
    </div>

    <div class="rounded-lg border border-blue-200 bg-blue-300 py-6 px-7.5 shadow-lg">
      <div class="flex h-11.5 w-11.5 items-center justify-center rounded-full bg-blue-500">
        <svg class="fill-white" width="20" height="22" viewBox="0 0 20 22" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11 15.1156C4.19376 15.1156 0.825012 8.61876 0.618762 8.28001C0.540012 8.13126 0.540012 7.86876 0.618762 7.72126C0.825012 7.38251 4.19376 0.88501 11 0.88501C17.8063 0.88501 21.175 7.38251 21.3813 7.72126C21.46 7.86876 21.46 8.13126 21.3813 8.28001C21.175 8.61876 17.8063 15.1156 11 15.1156ZM2.16251 8.00001C3.74001 10.0688 7.09001 13.8688 11 13.8688C14.91 13.8688 18.26 10.0688 19.8375 8.00001C18.26 5.93126 14.91 2.13126 11 2.13126C7.09001 2.13126 3.74001 5.93126 2.16251 8.00001Z" fill=""></path>
          <path d="M11 10.9219C9.38438 10.9219 8.07812 9.61562 8.07812 8C8.07812 6.38438 9.38438 5.07812 11 5.07812C12.6156 5.07812 13.9219 6.38438 13.9219 8C13.9219 9.61562 12.6156 10.9219 11 10.9219ZM11 6.625C10.3813 6.625 9.875 7.13125 9.875 7.75C9.875 8.36875 10.3813 8.875 11 8.875C11.6187 8.875 12.125 8.36875 12.125 7.75C12.125 7.13125 11.6187 6.625 11 6.625Z" fill=""></path>
        </svg>
      </div>

      <div class="mt-4 flex items-end justify-between">
        <div>
          <h4 class="text-2xl font-bold text-blue-900">
            <%= Competition.where('event_initial_date <= ? AND event_final_date >= ?', Date.current, Date.current).count %>
          </h4>
          <span class="text-sm font-medium text-blue-800">Active Competitions</span>
        </div>
      </div>
    </div>

    <div class="rounded-lg border border-blue-200 bg-blue-300 py-6 px-7.5 shadow-lg">
      <div class="flex h-11.5 w-11.5 items-center justify-center rounded-full bg-blue-500">
        <svg class="fill-white" width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 10H19V4C19 3.45 18.55 3 18 3H17V1C17 0.45 16.55 0 16 0C15.45 0 15 0.45 15 1V3H4C3.45 3 3 3.45 3 4V10H1C0.45 10 0 10.45 0 11C0 11.55 0.45 12 1 12H3V19C3 19.55 3.45 20 4 20H18C18.55 20 19 19.55 19 19V12H21C21.55 12 22 11.55 22 11C22 10.45 21.55 10 21 10ZM5 4H16V10H5V4ZM16 18H5V12H16V18Z" fill=""></path>
        </svg>
      </div>

      <div class="mt-4 flex items-end justify-between">
        <div>
          <h4 class="text-2xl font-bold text-blue-900">
            <%= Competition.where('event_final_date < ?', Date.current).count %>
          </h4>
          <span class="text-sm font-medium text-blue-800">Completed Competitions</span>
        </div>
      </div>
    </div>

    <div class="rounded-lg border border-blue-200 bg-blue-300 py-6 px-7.5 shadow-lg">
      <div class="flex h-11.5 w-11.5 items-center justify-center rounded-full bg-blue-500">
        <svg class="fill-white" width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 10H19V4C19 3.45 18.55 3 18 3H17V1C17 0.45 16.55 0 16 0C15.45 0 15 0.45 15 1V3H4C3.45 3 3 3.45 3 4V10H1C0.45 10 0 10.45 0 11C0 11.55 0.45 12 1 12H3V19C3 19.55 3.45 20 4 20H18C18.55 20 19 19.55 19 19V12H21C21.55 12 22 11.55 22 11C22 10.45 21.55 10 21 10ZM5 4H16V10H5V4ZM16 18H5V12H16V18Z" fill=""></path>
        </svg>
      </div>

      <div class="mt-4 flex items-end justify-between">
        <div>
          <h4 class="text-2xl font-bold text-blue-900">
            <%= Competition.where('event_initial_date > ?', Date.current).count %>
          </h4>
          <span class="text-sm font-medium text-blue-800">Upcoming Competitions</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Competitions -->
  <div class="mt-7.5">
    <div class="mb-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <h2 class="text-title-md2 font-bold text-black dark:text-white">
        Recent Competitions
      </h2>
      <%= link_to admin_competitions_path, class: "inline-flex items-center justify-center rounded-md bg-blue-600 py-2 px-10 text-center font-medium text-white hover:bg-blue-700 lg:px-8 xl:px-10" do %>
        View All
      <% end %>
    </div>

    <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
      <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
          <tr>
            <th scope="col" class="px-6 py-3">
              Competition Name
            </th>
            <th scope="col" class="px-6 py-3">
              Start Date
            </th>
            <th scope="col" class="px-6 py-3">
              End Date
            </th>
            <th scope="col" class="px-6 py-3">
              Status
            </th>
            <th scope="col" class="px-6 py-3">
              Actions
            </th>
          </tr>
        </thead>
        <tbody>
          <% if @recent_competitions.any? %>
            <% @recent_competitions.each do |competition| %>
              <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                  <%= competition.name %>
                </th>
                <td class="px-6 py-4">
                  <%= competition.event_initial_date&.strftime("%b %d, %Y") %>
                </td>
                <td class="px-6 py-4">
                  <%= competition.event_final_date&.strftime("%b %d, %Y") %>
                </td>
                <td class="px-6 py-4">
                  <% if competition.event_final_date && competition.event_final_date < Date.current %>
                    <span class="inline-flex rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800 dark:bg-red-900 dark:text-red-300">
                      Completed
                    </span>
                  <% elsif competition.event_initial_date && competition.event_initial_date <= Date.current %>
                    <span class="inline-flex rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800 dark:bg-green-900 dark:text-green-300">
                      Active
                    </span>
                  <% else %>
                    <span class="inline-flex rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">
                      Upcoming
                    </span>
                  <% end %>
                </td>
                <td class="px-6 py-4">
                  <%= link_to admin_competition_path(competition), class: "font-medium text-blue-600 dark:text-blue-500 hover:underline" do %>
                    View Details
                  <% end %>
                </td>
              </tr>
            <% end %>
          <% else %>
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
              <td colspan="5" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                No competitions found.
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
